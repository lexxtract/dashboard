var A=Object.defineProperty;var P=(o,e,n)=>e in o?A(o,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):o[e]=n;var d=(o,e,n)=>(P(o,typeof e!="symbol"?e+"":e,n),n);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const t of s)if(t.type==="childList")for(const i of t.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&r(i)}).observe(document,{childList:!0,subtree:!0});function n(s){const t={};return s.integrity&&(t.integrity=s.integrity),s.referrerpolicy&&(t.referrerPolicy=s.referrerpolicy),s.crossorigin==="use-credentials"?t.credentials="include":s.crossorigin==="anonymous"?t.credentials="omit":t.credentials="same-origin",t}function r(s){if(s.ep)return;s.ep=!0;const t=n(s);fetch(s.href,t)}})();class h{constructor(e){d(this,"value");d(this,"resolved");d(this,"previous");d(this,"listeners",[]);d(this,"listeners_once",[]);this.set(e)}async set(e,n=!1){if(e instanceof Promise)return!n&&e==this.value?void 0:(this.previous=this.resolved,this.resolved=void 0,this.value=e,this.value.then(r=>{e==this.value&&(this.resolved=r,r!=this.previous&&(this.listeners.forEach(s=>s(r)),this.listeners_once.forEach(s=>s(r)),this.listeners_once=[]))}));if(!n&&e==this.resolved)return;this.value=Promise.resolve(e),this.resolved=e,this.listeners.forEach(r=>r(e)),this.listeners_once.forEach(r=>r(e)),this.listeners_once=[]}subscribe(e){this.listeners.push(e),this.resolved!=null&&e(this.resolved)}subscribeLater(e){this.listeners.push(e)}get(){return new Promise((e,n)=>{if(this.resolved!=null)return e(this.resolved);let r=s=>{e(s)};this.listeners_once.push(r)})}then(e){return this.get().then(e)}async update(e,n=!1){return this.set(await this.get().then(e),n)}map(e){let n=new h(new Promise(()=>{}));return this.subscribe(r=>{n.set(e(r))}),n}}class $ extends h{constructor(n,r){localStorage.getItem(n)!==null&&(r=JSON.parse(localStorage.getItem(n)));super(r);d(this,"key");this.key=n,this.subscribe(s=>{localStorage.setItem(this.key,JSON.stringify(s))})}}const g=(o,e,n="",r)=>{const s=document.createElement(o);return s.innerText=e,r&&Object.entries(r).forEach(([t,i])=>{t==="parent"&&i.appendChild(s),t==="children"?i.forEach(l=>s.appendChild(l)):t==="eventListeners"?Object.entries(i).forEach(([l,b])=>{s.addEventListener(l,b)}):t==="color"||t==="background"?s.style[t]=i:t==="style"?Object.entries(i).forEach(([l,b])=>{l=l.replace(/([A-Z])/g,"-$1").toLowerCase(),s.style.setProperty(l,b)}):t==="class"?s.classList.add(...i.split(".").filter(l=>l)):s[t]=i}),s},S=(o,...e)=>{let n=[],r={};const s=t=>{if(typeof t=="string")n.push(g("span",t));else if(typeof t=="number")n.push(g("span",t.toString()));else if(t instanceof h){const i=f({class:"writable-container"});t.subscribe(l=>{i.innerHTML="",i.appendChild(f(l,{class:"writable-value"}))}),n.push(i)}else if(t instanceof Promise){const i=f();t.then(l=>{i.innerHTML="",i.appendChild(f(l))}),n.push(i)}else t instanceof HTMLElement?n.push(t):t instanceof Array?t.forEach(s):r={...r,...t}};for(let t of e)s(t);return g(o,"","",{...r,children:n})},a=o=>(...e)=>S(o,...e),m=a("p"),I=a("h2"),u=a("div"),C=a("button"),f=a("span"),O=a("table"),v=a("tr"),y=a("td"),k=a("th"),c=(...o)=>({style:Object.assign({},...o)}),T=(o,e)=>{const n=e.find(t=>t instanceof h),r=e.filter(t=>typeof t=="string").join(" "),s=S(o,...e);return n?(n.subscribe(t=>{s.value!=t.toString()&&(s.value=t.toString())}),s.onkeydown=t=>{t.key=="Enter"&&n.set(s.value)}):s.value=r,s},p=(...o)=>T("input",o),H=(...o)=>T("textarea",o),_=(...o)=>{const e=u({style:{background:"var(--background-color)",color:"var(--color)",padding:"1em",paddingBottom:"2em",borderRadius:"1em",zIndex:"2000",overflowY:"scroll"}},...o),n=u({style:{position:"fixed",top:"0",left:"0",width:"100%",height:"100%",background:"rgba(166, 166, 166, 0.5)",display:"flex",justifyContent:"center",alignItems:"center",zIndex:"2000"}});return n.appendChild(e),document.body.appendChild(n),n.onclick=()=>{n.remove()},e.onclick=r=>{r.stopPropagation()},n};let M=new $("terminal_hist",[]);M.subscribe(o=>o);const E="https://maincloud.spacetimedb.com",j=document.body,w="lexxtract";let L=null;function N(o,e,n,r,s){fetch(`${E}/v1/database/${w}/call/add_call`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${L}`},body:JSON.stringify({prompt:o,schema:e,response:n,provider:r,model:s})}).then(t=>t.text()).then(t=>{console.log(t)})}function B(o){return fetch(`${E}/v1/database/${w}/sql`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${L}`},body:o}).then(e=>(console.log(e),e.json())).then(e=>{e.length>1&&console.warn("multiple rows returned, TODO: handle this");let{schema:n,rows:r}=e[0];return{names:n.elements.map(s=>s.name.some),rows:r}}).catch(e=>(console.error(e),_(m(e.message)),{names:["error"],rows:[e.message]}))}let x=c({padding:"1.5em",margin:".5em",borderRadius:"1em",background:"var(--background-color)",color:"var(--color)",border:"1px solid #ccc"});j.appendChild(I("LEXXTRACT DATABASE DASHBOARD"));{let o=[p("generate text",{placeholder:"prompt"}),p("{'content': 'string'}",{placeholder:"schema"}),p("{'content': 'some text'}",{placeholder:"response"}),p("openrouter",{placeholder:"provider"}),p("gpt-4o",{placeholder:"model"})];document.body.appendChild(u(x,m("add call data:"),o,C("push",{onclick:()=>{N(o[0].value,o[1].value,o[2].value,o[3].value,o[4].value)}})))}{let o=H(c({fontFamily:"monospace",padding:".5em"}),"select * from llm_result limit 100");o.rows=2,o.cols=100;let e=u();j.append(u(x,m("SQL console:"),o,C("run",{onclick:()=>{e.innerHTML="",e.append(m("running...")),B(o.value).then(n=>{e.innerHTML="",e.append(O(x,v(...n.names.map(r=>k(c({border:"1px solid #ccc",padding:".5em"}),r))),...n.rows.map(r=>v(c({cursor:"pointer"}),{onclick:()=>{_(O(n.names.map((s,t)=>v(y(s,c({border:"1px solid #ccc",padding:".5em"})),y(r[t],c({border:"1px solid #ccc",padding:".5em"})))),c({borderCollapse:"collapse"})))}},...r.map(s=>y(c({border:"1px solid #ccc",padding:".5em"}),s)))),c({borderCollapse:"collapse"})))})}}),e))}async function D(){await fetch(`${E}/v1/identity`,{method:"POST",headers:{"Content-Type":"application/json"}}).then(o=>o.json()).then(o=>L=o.token)}D();
